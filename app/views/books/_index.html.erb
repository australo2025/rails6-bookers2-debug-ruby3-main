<table class='table table-hover table-inverse'>
  <thead>
    <tr>
      <th></th>
      <th>Title</th>
      <th>Opinion</th>
      <th>Tag</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% books.each do |book| %>
      <tr>
        <td><%= link_to(book.user) do %>
          <%= image_tag book.user.get_profile_image, size:'50x50' %>
          <% end %>
        </td>
        <td><%= link_to book.title,book %></td>

        <td>
        <% if book.tag %>
          <%= link_to book.tag.name, books_path(tag: book.tag.name, sort: params[:sort]) %>
        <% else %>
          ー
        <% end %>
        </td>
        
        <td><%= book.body %></td>
        
        <td>
        <span id="favorite-<%= book.id %>">
          <%= render 'favorites/button', book: book %>
        </span>
        </td>

        <td><%= link_to "#{book.post_comments.count} コメント", book_path(book.id) %></td>
        <td>閲覧数: <%= book.view_count %></td>

        <td>
        <% if book.rate.present? %>
          <div id="rate_book_<%= book.id %>"></div>
          <script>
            onReady(function(){
              const el = document.querySelector('#rate_book_<%= book.id %>');
              if (!el) return;
              raty(el, {
                readOnly: true,
                score: <%= book.rate %>,
                number: 5,
                starOn:  "<%= asset_path('star-on.png')  %>",
                starOff: "<%= asset_path('star-off.png') %>",
                starHalf:"<%= asset_path('star-half.png') %>"
              });
            });
          </script>
        <% else %>
          <span class="text-muted">未評価</span>
        <% end %>
         </td>

      </tr>
    <% end %>
  </tbody>
</table>